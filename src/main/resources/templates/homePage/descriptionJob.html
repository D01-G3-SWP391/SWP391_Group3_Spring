<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Chi tiết công việc</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/navbarHome.css}"/>
    <link rel="stylesheet" th:href="@{/css/navbar.css}"/>
    <link rel="stylesheet" th:href="@{/css/job-des.css}"/>
    <link rel="stylesheet" th:href="@{/css/apply-form.css}"/>
</head>
<body>
<div th:replace="~{navbar/navbarHome}"></div>

<div class="job-card" th:each="job : ${jobPosts}">
    <div class="job-card-header">
        <div class="company-logo default-logo">
            <span th:text="${job.employer.logoUrl != null ? job.employer.logoUrl : 'PHY'}"></span>
        </div>
        <div class="job-info">
            <h3 class="job-title" th:text="${job.jobTitle}"></h3>
            <p class="company-name" th:text="${job.employer.companyName}"></p>
            <div class="job-type">
                <span class="job-type-badge full-time" th:text="${job.jobType}"></span>
            </div>
        </div>
    </div>

    <div class="job-card-body">
        <div class="tab-buttons">
            <button class="tab-button" onclick="openTab('job')">VIỆC LÀM</button>
            <button class="tab-button active" onclick="openTab('info')">THÔNG TIN</button>
            <button class="tab-button" onclick="openTab('company')">CÔNG TY</button>
        </div>

        <div id="info-tab" class="tab-content active">
            <div class="job-details">
                <div class="job-detail-item">
                    <i class="fas fa-map-marker-alt"></i>
                    <span th:text="${job.jobLocation}"></span>
                </div>
            </div>
        </div>

        <div id="company-tab" class="tab-content">
            <div class="company_description">
                <h2>Thông tin công ty</h2>
                <p th:text="${job.employer.companyDescription}"></p>
            </div>
        </div>

        <div id="job-tab" class="tab-content">
            <div class="jobs_description">
                <h2>Mô tả công việc</h2>
                <div th:utext="${#strings.replace(job.jobDescription,'\n','<br />')}"></div>
            </div>
        </div>
    </div>

    <div class="job-card-footer">
        <!-- Nút Apply mở modal -->
        <button class="apply-btn" onclick="showApplyForm()">Apply <i class="fas fa-arrow-right"></i></button>
        <button class="save-btn"><i class="far fa-heart"></i></button>
    </div>
</div>

<!-- Modal Form Overlay -->
<div id="applyModal" class="modal-overlay hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Ứng tuyển</h2>
            <button class="close-btn" onclick="closeApplyForm()">&times;</button>
        </div>

        <!-- Modal Form với th:value đúng -->
        <form th:action="@{/Student/addJobApplication}" method="post" th:object="${jobApplicationDTO}">
            <div th:each="job : ${jobPosts}">
                <input type="hidden" th:value="${studentDetails?.studentId}" name="studentId">
                <input type="hidden" th:value="${job.jobPostId}" name="jobPostId">
            </div>

            <div class="form-group">
                <label for="fullName">Họ và tên *</label>
                <input type="text" id="fullName" name="fullName" th:field="*{fullname}" required/>
            </div>

            <div class="form-group">
                <label for="email">Email *</label>
                <input type="email" id="email" name="email" th:field="*{email}" required/>
            </div>

            <div class="form-group">
                <label for="phone">SĐT *</label>
                <input type="text" id="phone" name="phone" th:field="*{phoneNumber}" required/>
            </div>

            <div class="form-group">
                <label for="content">Nội dung *</label>
                <textarea id="content" name="content" th:field="*{description}"
                          placeholder="Tôi muốn ứng tuyển vị trí này" required></textarea>
            </div>

            <div class="form-group">
                <label for="cv">Hồ sơ ứng viên (CV)</label>
                <input th:field="*{cv_url}" type="file" id="cv" name="cv"
                       accept=".doc,.docx,.pdf,.png,.jpeg"/>
                <p class="file-info">Hỗ trợ định dạng doc, docx, pdf, png, jpeg nhỏ hơn 2048KB</p>
                <p class="cv-tip">Gửi kèm hồ sơ (CV) giúp bạn tăng cơ hội được tuyển dụng</p>
            </div>

            <div class="button-group">
                <button type="submit" class="submit-btn">Gửi</button>
                <button type="button" class="cancel-btn" onclick="closeApplyForm()">Đóng</button>
            </div>
        </form>
    </div>
</div>

<script>
    // Modal Functions
    function showApplyForm() {
        document.getElementById('applyModal').classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }

    function closeApplyForm() {
        document.getElementById('applyModal').classList.add('hidden');
        document.body.style.overflow = 'auto';
    }

    // Event Listeners
    document.addEventListener('DOMContentLoaded', function() {
        const modal = document.getElementById('applyModal');

        if (modal) {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    closeApplyForm();
                }
            });
        }

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
                closeApplyForm();
            }
        });
    });

    // Tab Navigation
    function openTab(tabName) {
        const tabContents = document.getElementsByClassName('tab-content');
        const tabButtons = document.getElementsByClassName('tab-button');

        for (let i = 0; i < tabContents.length; i++) {
            tabContents[i].classList.remove('active');
            tabButtons[i].classList.remove('active');
        }

        document.getElementById(tabName + '-tab').classList.add('active');
        event.target.classList.add('active');
    }
</script>
</body>
</html>
