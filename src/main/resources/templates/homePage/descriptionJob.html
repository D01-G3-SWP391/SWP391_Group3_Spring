<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="#{job.description.title}">Chi tiết công việc</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/navbarHome.css}"/>
    <link rel="stylesheet" th:href="@{/css/navbar.css}"/>
    <link rel="stylesheet" th:href="@{/css/index.css}"/>
    <link rel="stylesheet" th:href="@{/css/job-des.css}"/>
    <link rel="stylesheet" th:href="@{/css/apply-form.css}"/>
    <link rel="stylesheet" th:href="@{/css/language-switcher.css}" />
    <link
            href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600&display=swap"
            rel="stylesheet"
    />
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css"
            rel="stylesheet"
    />
    <style>
        /* Ensure navbar is visible and positioned correctly */
        .navbar-container {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            z-index: 1000 !important;
            background-color: #fff !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
        }
        
        /* Ensure body has proper padding */
        body {
            padding-top: 80px !important;
        }
    </style>
</head>
<body>
<div th:replace="~{navbar/navbarHome}"></div>

    <!-- Header Section -->
    <section class="job-detail-header">
        <div class="container">
            <div class="header-content" th:each="job : ${jobPosts}">
                <div class="breadcrumb">
                    <a href="/" class="breadcrumb-link">
                        <i class="fas fa-home"></i> <span th:text="#{job.description.breadcrumb.home}">Trang chủ</span>
                    </a>
                    <span class="breadcrumb-separator">/</span>
                    <span class="breadcrumb-current" th:text="#{job.description.breadcrumb.current}">Chi tiết công việc</span>
                </div>

                <div class="job-hero">
                    <div class="job-hero-left">
                        <div class="company-logo-large">
                            <img
                                th:src="${job.employer.logoUrl}"
                                th:alt="${job.employer.companyName}"
                                onerror="this.style.display='none'; this.parentElement.classList.add('default-logo'); this.parentElement.innerHTML='<span>' + this.alt.charAt(0).toUpperCase() + '</span>';"
                            />
                        </div>
                        <div class="job-hero-info">
                            <h1 class="job-title-large" th:text="${job.jobTitle}">Tiêu đề công việc</h1>
                            <p class="company-name-large" th:text="${job.employer.companyName}">Tên công ty</p>
                            <div class="job-quick-info">
                                <span class="job-type-badge-large"
                                      th:classappend="${job.jobType?.name() == 'FULL_TIME' ? 'full-time' : 'part-time'}">
                                    <span th:if="${job.jobType?.name() == 'FULL_TIME'}" th:text="#{job.description.fullTime}">Toàn thời gian</span>
                                    <span th:if="${job.jobType?.name() == 'PART_TIME'}" th:text="#{job.description.partTime}">Bán thời gian</span>
                                </span>
                                <span class="job-posted-date">
                                    <i class="fas fa-clock"></i>
                                    <span th:text="#{job.description.postedOn}">Đăng ngày</span> <span th:text="${#temporals.format(job.createdAt, 'dd/MM/yyyy')}">01/01/2024</span>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="job-hero-right">
                        <div class="job-actions">
                            <button class="btn-primary-large" onclick="showApplyForm()">
                                <i class="fas fa-paper-plane"></i>
                                <span th:text="#{job.description.applyNow}">Ứng tuyển ngay</span>
                            </button>
                            <button class="btn-save-large">
                                <i class="far fa-heart"></i>
                                <span th:text="#{job.description.saveJob}">Lưu việc làm</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <section class="job-detail-content">
        <div class="container">
            <div class="content-wrapper" th:each="job : ${jobPosts}">
                <div class="main-content">
                    <!-- Job Quick Details -->
                    <div class="job-quick-details">
                        <h2 th:text="#{job.description.generalInfo}">Thông tin chung</h2>
                        <div class="details-grid">
                            <div class="detail-item">
                                <div class="detail-icon">
                                    <i class="fas fa-map-marker-alt"></i>
                                </div>
                                <div class="detail-content">
                                    <span class="detail-label" th:text="#{job.description.location}">Địa điểm</span>
                                    <span class="detail-value" th:text="${job.jobLocation}">Hà Nội</span>
                                </div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-icon">
                                    <i class="fas fa-money-bill-wave"></i>
                                </div>
                                <div class="detail-content">
                                    <span class="detail-label" th:text="#{job.description.salary}">Mức lương</span>
                                    <span class="detail-value" th:text="${job.jobSalary}">Thỏa thuận</span>
                                </div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-icon">
                                    <i class="fas fa-briefcase"></i>
                                </div>
                                <div class="detail-content">
                                    <span class="detail-label" th:text="#{job.description.jobType}">Loại công việc</span>
                                    <span class="detail-value">
                                        <span th:if="${job.jobType?.name() == 'FULL_TIME'}" th:text="#{job.description.fullTime}">Toàn thời gian</span>
                                        <span th:if="${job.jobType?.name() == 'PART_TIME'}" th:text="#{job.description.partTime}">Bán thời gian</span>
                                    </span>
                                </div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-icon">
                                    <i class="fas fa-layer-group"></i>
                                </div>
                                <div class="detail-content">
                                    <span class="detail-label" th:text="#{job.description.field}">Lĩnh vực</span>
                                    <span class="detail-value" th:text="${job.jobField.jobFieldName}">Công nghệ thông tin</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tab Navigation -->
                    <div class="tab-navigation">
                        <button class="tab-button active" onclick="openTab('description')">
                            <i class="fas fa-file-alt"></i>
                            <span th:text="#{job.description.tabs.description}">Mô tả công việc</span>
                        </button>
                        <button class="tab-button" onclick="openTab('requirements')">
                            <i class="fas fa-list-check"></i>
                            <span th:text="#{job.description.tabs.requirements}">Yêu cầu công việc</span>
                        </button>
                        <button class="tab-button" onclick="openTab('company')">
                            <i class="fas fa-building"></i>
                            <span th:text="#{job.description.tabs.company}">Thông tin công ty</span>
                        </button>
                    </div>

                    <!-- Tab Content -->
                    <div class="tab-contents">
                        <div id="description-tab" class="tab-content active">
                            <div class="content-section">
                                <h3 th:text="#{job.description.tabs.description}">Mô tả công việc</h3>
                                <div class="job-description-content" th:utext="${#strings.replace(job.jobDescription,'\n','<br />')}">
                                    Mô tả công việc sẽ hiển thị ở đây...
                                </div>
                            </div>
                        </div>

                        <div id="requirements-tab" class="tab-content">
                            <div class="content-section">
                                <h3 th:text="#{job.description.tabs.requirements}">Yêu cầu công việc</h3>
                                <div class="job-requirements-content" th:utext="${#strings.replace(job.jobRequirements,'\n','<br />')}">
                                    Yêu cầu công việc sẽ hiển thị ở đây...
                                </div>
                            </div>
                        </div>

                        <div id="company-tab" class="tab-content">
                            <div class="content-section">
                                <h3 th:text="#{job.description.companyIntro}">Giới thiệu công ty</h3>
                                <div class="company-info">
                                    <div class="company-basic-info">
                                        <div class="company-logo-info">
                                            <img
                                                th:src="${job.employer.logoUrl}"
                                                th:alt="${job.employer.companyName}"
                                                onerror="this.style.display='none'; this.parentElement.classList.add('default-logo'); this.parentElement.innerHTML='<span>' + this.alt.charAt(0).toUpperCase() + '</span>';"
                                            />
                                        </div>
                                        <div class="company-details">
                                            <h4 th:text="${job.employer.companyName}">Tên công ty</h4>
                                            <p class="company-field" th:text="${job.jobField.jobFieldName}">Lĩnh vực hoạt động</p>
                                        </div>
                                    </div>
                                    <div class="company-description" th:utext="${#strings.replace(job.employer.companyDescription,'\n','<br />')}">
                                        Mô tả công ty sẽ hiển thị ở đây...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sidebar -->
                <div class="sidebar">
                    <div class="sidebar-section company-info-sidebar">
                        <h3 th:text="#{job.description.companyInfo}">Thông tin công ty</h3>
                        <div class="company-sidebar-details">
                            <div class="company-sidebar-logo">
                                <img
                                    th:src="${job.employer.logoUrl}"
                                    th:alt="${job.employer.companyName}"
                                    onerror="this.style.display='none'; this.parentElement.classList.add('default-logo'); this.parentElement.innerHTML='<span>' + this.alt.charAt(0).toUpperCase() + '</span>';"
                                />
                            </div>
                            <h4 th:text="${job.employer.companyName}">Tên công ty</h4>
                            <div class="company-sidebar-info">
                                <div class="info-item">
                                    <i class="fas fa-industry"></i>
                                    <span th:text="${job.jobField.jobFieldName}">Lĩnh vực</span>
                                </div>
                                <div class="info-item">
                                    <i class="fas fa-map-marker-alt"></i>
                                    <span th:text="${job.jobLocation}">Địa điểm</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Related Jobs Section (similar to other pages) -->
    <section class="why-choose-us">
        <div class="section-header">
            <h2 th:text="#{job.description.whyChoose}">Tại sao chọn Job4You?</h2>
        </div>
        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-briefcase"></i>
                </div>
                <h3 th:text="#{job.description.feature1.title}">Hàng nghìn việc làm</h3>
                <p th:text="#{job.description.feature1.desc}">Cơ hội việc làm đa dạng từ các công ty hàng đầu</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-users"></i>
                </div>
                <h3 th:text="#{job.description.feature2.title}">Nhà tuyển dụng uy tín</h3>
                <p th:text="#{job.description.feature2.desc}">Kết nối với các công ty được xác minh và đáng tin cậy</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <h3 th:text="#{job.description.feature3.title}">Phát triển sự nghiệp</h3>
                <p th:text="#{job.description.feature3.desc}">Công cụ và tài nguyên hỗ trợ phát triển nghề nghiệp</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <h3 th:text="#{job.description.feature4.title}">An toàn & bảo mật</h3>
                <p th:text="#{job.description.feature4.desc}">Thông tin cá nhân được bảo vệ tuyệt đối</p>
            </div>
        </div>
    </section>

    <!-- Footer (reuse from other templates) -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Job4You</h3>
                    <p>Nền tảng tuyển dụng hàng đầu Việt Nam, kết nối nhà tuyển dụng với ứng viên tài năng.</p>
                    <div class="footer-social">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-linkedin-in"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
                <div class="footer-section">
                    <h4>Dành cho ứng viên</h4>
                    <ul>
                        <li><a href="#">Tìm việc làm</a></li>
                        <li><a href="#">Tạo CV</a></li>
                        <li><a href="#">Cẩm nang nghề nghiệp</a></li>
                        <li><a href="#">Tính lương Gross/Net</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Dành cho nhà tuyển dụng</h4>
                    <ul>
                        <li><a href="#">Đăng tin tuyển dụng</a></li>
                        <li><a href="#">Tìm hồ sơ</a></li>
                        <li><a href="#">Báo cáo thị trường</a></li>
                        <li><a href="#">Dịch vụ HR</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Liên hệ</h4>
                    <ul>
                        <li><i class="fas fa-map-marker-alt"></i> Hà Nội, Việt Nam</li>
                        <li><i class="fas fa-phone"></i> (+84) 123 456 789</li>
                        <li><i class="fas fa-envelope"></i> contact@job4you.vn</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <div class="footer-bottom-left">
                    <p>&copy; 2024 Job4You. Tất cả quyền được bảo lưu.</p>
                </div>
                <div class="footer-bottom-right">
                    <a href="#">Điều khoản sử dụng</a>
                    <a href="#">Chính sách bảo mật</a>
                </div>
            </div>
        </div>
    </footer>

<!-- Modal Form Overlay -->
<div id="applyModal" class="modal-overlay hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h2 th:text="#{apply.form.title}">Ứng tuyển</h2>
            <button class="close-btn" onclick="closeApplyForm()">&times;</button>
        </div>

        <!-- Modal Form với th:value đúng -->
        <form th:action="@{/Student/addJobApplication}" method="post" th:object="${jobApplicationDTO}" enctype="multipart/form-data">
            <div th:each="job : ${jobPosts}">
                <input type="hidden" th:value="${studentDetails?.studentId}" name="studentId">
                <input type="hidden" th:value="${job.jobPostId}" name="jobPostId">
            </div>

            <div class="form-group">
                <label for="fullName" th:text="#{apply.form.fullName}">Họ và tên</label> *
                <input type="text" id="fullName" name="fullName" th:field="*{fullname}" required/>
            </div>

            <div class="form-group">
                <label for="email" th:text="#{apply.form.email}">Email</label> *
                <input type="email" id="email" name="email" th:field="*{email}" required/>
            </div>

            <div class="form-group">
                <label for="phone" th:text="#{apply.form.phone}">SĐT</label> *
                <input type="text" id="phone" name="phone" th:field="*{phoneNumber}" required/>
            </div>

            <div class="form-group">
                <label for="content" th:text="#{apply.form.content}">Nội dung</label> *
                <textarea id="content" name="content" th:field="*{description}"
                          th:placeholder="#{apply.form.content.placeholder}" required></textarea>
            </div>

            <div class="form-group">
                <label for="cv" th:text="#{apply.form.cv}">Hồ sơ ứng viên (CV)</label>
                <input type="file" id="cv" name="cv" 
                       accept=".pdf,.png,.jpg,.jpeg,.gif" onchange="validateCVFile(this)"/>
                <p class="file-info" th:text="#{apply.form.cv.info}">Hỗ trợ định dạng PDF và ảnh (png, jpg, jpeg, gif) nhỏ hơn 2048KB</p>
                <p class="cv-tip" th:text="#{apply.form.cv.tip}">Gửi kèm hồ sơ (CV) giúp bạn tăng cơ hội được tuyển dụng</p>
                <div id="cv-error-modal" class="file-error" style="display: none;"></div>
            </div>

            <div class="button-group">
                <button type="submit" class="submit-btn" th:text="#{apply.form.submit}">Gửi</button>
                <button type="button" class="cancel-btn" onclick="closeApplyForm()" th:text="#{apply.form.close}">Đóng</button>
            </div>
        </form>
    </div>
</div>

    <script>
        // CV File Validation Function
        function validateCVFile(input) {
            const errorDiv = document.getElementById('cv-error-modal');
            const allowedTypes = ['application/pdf', 'image/png', 'image/jpg', 'image/jpeg', 'image/gif'];
            const maxSize = 2048 * 1024; // 2048KB in bytes
            
            // Clear previous errors
            errorDiv.style.display = 'none';
            errorDiv.textContent = '';
            input.setCustomValidity('');
            
            if (input.files.length === 0) {
                return true; // No file selected is okay
            }
            
            const file = input.files[0];
            
            // Check file type
            if (!allowedTypes.includes(file.type)) {
                const errorMessage = 'Chỉ chấp nhận file PDF và ảnh (PNG, JPG, JPEG, GIF)';
                showFileError(errorDiv, errorMessage);
                input.setCustomValidity(errorMessage);
                input.value = ''; // Clear the input
                return false;
            }
            
            // Check file size
            if (file.size > maxSize) {
                const errorMessage = 'Kích thước file không được vượt quá 2048KB';
                showFileError(errorDiv, errorMessage);
                input.setCustomValidity(errorMessage);
                input.value = ''; // Clear the input
                return false;
            }
            
            return true;
        }
        
        function showFileError(errorDiv, message) {
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        // Modal Functions
        function showApplyForm() {
            const modal = document.getElementById('applyModal');
            if (modal) {
                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            }
        }

        function closeApplyForm() {
            const modal = document.getElementById('applyModal');
            if (modal) {
                modal.classList.add('hidden');
                document.body.style.overflow = 'auto';
            }
        }

        // Tab Navigation
        function openTab(tabName) {
            const tabContents = document.getElementsByClassName('tab-content');
            const tabButtons = document.getElementsByClassName('tab-button');

            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
                tabButtons[i].classList.remove('active');
            }

            const targetTab = document.getElementById(tabName + '-tab');
            if (targetTab && event.target) {
                targetTab.classList.add('active');
                event.target.classList.add('active');
            }
        }

        // Enhanced interaction effects
        document.addEventListener('DOMContentLoaded', function() {
            // Form submission validation
            const form = document.querySelector('form[th\\:action*="addJobApplication"]');
            if (form) {
                form.addEventListener('submit', function(e) {
                    const cvInput = document.getElementById('cv');
                    if (cvInput && cvInput.files.length > 0) {
                        if (!validateCVFile(cvInput)) {
                            e.preventDefault();
                            return false;
                        }
                    }
                });
            }

            // Modal event listeners
            const modal = document.getElementById('applyModal');
            if (modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeApplyForm();
                    }
                });
            }

            // Keyboard event for modal
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && modal && !modal.classList.contains('hidden')) {
                    closeApplyForm();
                }
            });

            // Add smooth scrolling for anchor links
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });

            // Add hover effects for interactive elements
            const interactiveElements = document.querySelectorAll('.btn-primary-large, .btn-save-large, .tab-button');
            interactiveElements.forEach(element => {
                element.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-2px)';
                });

                element.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                });
            });
        });
    </script>
    <script th:src="@{/js/languageSwitch.js}"></script>
</body>
</html>
