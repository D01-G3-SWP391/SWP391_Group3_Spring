<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - THCLT JOBS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/navbarAdmin.css}">
    <link rel="stylesheet" th:href="@{/css/adminCommon.css}">
    <link rel="stylesheet" th:href="@{/css/language_sidebar.css}" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .dashboard-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: none;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            overflow: hidden;
        }
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }
        .card-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            margin-bottom: 15px;
        }
        .student-gradient { background: linear-gradient(135deg, #4f46e5, #7c3aed); }
        .employer-gradient { background: linear-gradient(135deg, #059669, #10b981); }
        .job-gradient { background: linear-gradient(135deg, #dc2626, #ef4444); }
        .event-gradient { background: linear-gradient(135deg, #d97706, #f59e0b); }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1e293b;
            margin: 0;
        }
        .stat-label {
            color: #64748b;
            font-size: 0.95rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .progress-custom {
            height: 8px;
            border-radius: 10px;
            background-color: #f1f5f9;
        }
        .progress-bar-custom {
            border-radius: 10px;
        }
        .quick-action-btn {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            text-decoration: none;
            color: #475569;
            display: block;
        }
        .quick-action-btn:hover {
            border-color: #4f46e5;
            color: #4f46e5;
            transform: translateY(-2px);
            text-decoration: none;
        }
        .welcome-section {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }
        .welcome-section::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 300px;
            height: 300px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
        }
        .activity-item {
            padding: 15px;
            border-left: 4px solid #e2e8f0;
            margin-bottom: 10px;
            background: white;
            border-radius: 0 8px 8px 0;
            transition: all 0.3s ease;
        }
        .activity-item:hover {
            border-left-color: #4f46e5;
            transform: translateX(5px);
        }
        .dashboard-card.flex-fill {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        .row.g-4.align-items-stretch > [class^='col-'] {
            display: flex;
            flex-direction: column;
        }
        .quick-action-btn {
            width: 100%;
            height: 100%;
            border-radius: 12px;
        }
        .row.g-3.gx-0 {
            margin-left: 0;
            margin-right: 0;
        }
        .card-body {
            padding-left: 0.5rem;
            padding-right: 0.5rem;
            padding-bottom: 0.5rem;
        }
        .card.dashboard-card, .card-body {
            height: 100%;
        }
        .quick-action-btn {
            width: 100%;
            height: 100%;
            border-radius: 12px;
            min-height: 120px;
        }
        
        /* Chart filter buttons styling */
        .btn-group .btn-outline-primary {
            border-color: #e2e8f0;
            color: #64748b;
            font-size: 0.875rem;
            padding: 0.5rem 0.75rem;
            transition: all 0.2s ease;
        }
        
        .btn-group .btn-outline-primary:hover {
            background-color: #4f46e5;
            border-color: #4f46e5;
            color: white;
            transform: translateY(-1px);
        }
        
        .btn-group .btn-check:checked + .btn-outline-primary {
            background-color: #4f46e5;
            border-color: #4f46e5;
            color: white;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
        }
        
        .chart-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #64748b;
            font-size: 0.875rem;
        }
        
        /* Enhanced chart container */
        .chart-container {
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 48, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(5, 150, 105, 0.03) 0%, transparent 50%),
                linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 
                0 4px 6px -1px rgba(0, 0, 0, 0.1),
                0 2px 4px -1px rgba(0, 0, 0, 0.06),
                inset 0 1px 0 rgba(255, 255, 255, 0.7);
            position: relative;
            overflow: hidden;
        }
        
        .chart-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(79, 70, 229, 0.3), transparent);
        }
        
        .chart-container::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 1px 1px, rgba(79, 70, 229, 0.15) 1px, transparent 0);
            background-size: 20px 20px;
            opacity: 0.4;
            pointer-events: none;
        }
        
        /* Chart legend styling */
        .chart-legend {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        /* Enhanced card styling */
        .chart-card {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid rgba(226, 232, 240, 0.8);
            border-radius: 20px;
            box-shadow: 
                0 10px 25px rgba(0, 0, 0, 0.1),
                0 4px 6px rgba(0, 0, 0, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            overflow: hidden;
            position: relative;
        }
        
        .chart-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #4f46e5, #7c3aed, #059669, #dc2626);
        }
        
        .chart-card:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.12),
                0 8px 16px rgba(0, 0, 0, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
        }
        
        /* Floating animation for chart icons */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-6px); }
        }
        
        .chart-icon {
            animation: float 3s ease-in-out infinite;
        }
        
        /* Chart entrance animation */
        @keyframes chartEntrance {
            0% {
                opacity: 0;
                transform: scale(0.8) translateY(30px);
            }
            100% {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        .chart-container {
            animation: chartEntrance 0.8s ease-out;
        }
        
        /* Legend item hover effects */
        .legend-item {
            transition: all 0.3s ease;
            cursor: pointer;
            border-radius: 8px;
            padding: 0.5rem;
        }
        
        .legend-item:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .legend-color {
            transition: all 0.3s ease;
        }
        
        .legend-item:hover .legend-color {
            transform: scale(1.2);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        /* Pulse animation for loading */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .chart-loading .fa-spinner {
            animation: spin 1s linear infinite, pulse 2s ease-in-out infinite;
        }
        
        /* Glowing effect for active filter */
        .btn-check:checked + .btn-outline-primary {
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from {
                box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
            }
            to {
                box-shadow: 0 4px 20px rgba(79, 70, 229, 0.6);
            }
        }
    </style>
</head>
<body>
<div th:replace="~{navbar/navbarAdmin :: navbarAdmin}"></div>

<div class="main-content">
    <div class="container-fluid">
        <!-- Welcome Section -->
        <div class="welcome-section">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="mb-3">
                        <i class="fas fa-tachometer-alt me-3"></i>
                        Admin Dashboard
                    </h1>
                    <p class="mb-0 fs-5 opacity-90">
                        Welcome to THCLT JOBS administration panel. Monitor and manage your platform efficiently.
                    </p>
                </div>
                <div class="col-md-4 text-end">
                    <div class="fs-1 opacity-30">
                        <i class="fas fa-chart-line"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="row g-4 mb-5">
            <!-- Students Statistics -->
            <div class="col-xl-3 col-md-6">
                <div class="card dashboard-card h-100">
                    <div class="card-body text-center">
                        <div class="card-icon student-gradient mx-auto">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <h3 class="stat-number" th:text="${totalStudents ?: 0}">0</h3>
                        <p class="stat-label mb-3">Total Students</p>
                        <div class="progress progress-custom mb-2">
                            <div class="progress-bar progress-bar-custom student-gradient" 
                                 th:style="'width: ' + ${studentActivePercentage ?: 0} + '%'"></div>
                        </div>
                        <small class="text-muted">
                            <span th:text="${activeStudents ?: 0}">0</span> active • 
                            <span th:text="${bannedStudents ?: 0}">0</span> banned
                        </small>
                    </div>
                </div>
            </div>

            <!-- Employers Statistics -->
            <div class="col-xl-3 col-md-6">
                <div class="card dashboard-card h-100">
                    <div class="card-body text-center">
                        <div class="card-icon employer-gradient mx-auto">
                            <i class="fas fa-building"></i>
                        </div>
                        <h3 class="stat-number" th:text="${totalEmployers ?: 0}">0</h3>
                        <p class="stat-label mb-3">Total Employers</p>
                        <div class="progress progress-custom mb-2">
                            <div class="progress-bar progress-bar-custom employer-gradient" 
                                 th:style="'width: ' + ${employerActivePercentage ?: 0} + '%'"></div>
                        </div>
                        <small class="text-muted">
                            <span th:text="${activeEmployers ?: 0}">0</span> active • 
                            <span th:text="${bannedEmployers ?: 0}">0</span> banned
                        </small>
                    </div>
                </div>
            </div>

            <!-- Job Posts Statistics -->
            <div class="col-xl-3 col-md-6">
                <div class="card dashboard-card h-100">
                    <div class="card-body text-center">
                        <div class="card-icon job-gradient mx-auto">
                            <i class="fas fa-briefcase"></i>
                        </div>
                        <h3 class="stat-number" th:text="${totalJobPosts ?: 0}">0</h3>
                        <p class="stat-label mb-3">Job Posts</p>
                        <div class="progress progress-custom mb-2">
                            <div class="progress-bar progress-bar-custom job-gradient" 
                                 th:style="'width: ' + (${activeJobPosts ?: 0} * 100 / (${totalJobPosts ?: 1})) + '%'">
                            </div>
                        </div>
                        <small class="text-muted">
                            <span th:text="${activeJobPosts ?: 0}">0</span> active • 
                            <span th:text="${pendingJobPosts ?: 0}">0</span> pending
                        </small>
                    </div>
                </div>
            </div>

            <!-- Events Statistics -->
            <div class="col-xl-3 col-md-6">
                <div class="card dashboard-card h-100">
                    <div class="card-body text-center">
                        <div class="card-icon event-gradient mx-auto">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <h3 class="stat-number" th:text="${totalEvents ?: 0}">0</h3>
                        <p class="stat-label mb-3">Career Events</p>
                        <div class="progress progress-custom mb-2">
                            <div class="progress-bar progress-bar-custom event-gradient" 
                                 th:style="'width: ' + (${upcomingEvents ?: 0} * 100 / (${totalEvents ?: 1})) + '%'">
                            </div>
                        </div>
                        <small class="text-muted">
                            <span th:text="${upcomingEvents ?: 0}">0</span> upcoming • 
                            <span th:text="${pastEvents ?: 0}">0</span> past
                        </small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics Trend Chart -->
        <div class="row mb-5">
            <div class="col-12">
                <div class="card chart-card">
                    <div class="card-header bg-transparent border-0 pb-0">
                        <div class="row align-items-center">
                            <div class="col">
                                <h5 class="card-title mb-2 d-flex align-items-center">
                                    <div class="d-flex align-items-center justify-content-center me-3 chart-icon" 
                                         style="width: 40px; height: 40px; background: linear-gradient(135deg, #4f46e5, #7c3aed); border-radius: 12px; box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);">
                                        <i class="fas fa-chart-line text-white"></i>
                                    </div>
                                    <div>
                                        <div style="font-size: 1.25rem; font-weight: 600; color: #1e293b;">
                                            Xu Hướng Thống Kê
                                        </div>
                                        <small class="text-muted d-block mt-1" id="chartSubtitle">Thống kê theo tháng gần đây</small>
                                    </div>
                                </h5>
                            </div>
                            <div class="col-auto">
                                <div class="btn-group btn-group-sm" role="group" style="box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); border-radius: 12px; overflow: hidden;">
                                    <input type="radio" class="btn-check" name="chartPeriod" id="chartDay" value="day">
                                    <label class="btn btn-outline-primary" for="chartDay">
                                        <i class="fas fa-calendar-day me-1"></i>Ngày
                                    </label>
                                    
                                    <input type="radio" class="btn-check" name="chartPeriod" id="chartWeek" value="week">
                                    <label class="btn btn-outline-primary" for="chartWeek">
                                        <i class="fas fa-calendar-week me-1"></i>Tuần
                                    </label>
                                    
                                    <input type="radio" class="btn-check" name="chartPeriod" id="chartMonth" value="month" checked>
                                    <label class="btn btn-outline-primary" for="chartMonth">
                                        <i class="fas fa-calendar me-1"></i>Tháng
                                    </label>
                                    
                                    <input type="radio" class="btn-check" name="chartPeriod" id="chartYear" value="year">
                                    <label class="btn btn-outline-primary" for="chartYear">
                                        <i class="fas fa-calendar-alt me-1"></i>Năm
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body pt-3">
                        <div class="chart-container">
                            <div style="position: relative; height: 400px;">
                                <canvas id="statisticsChart"></canvas>
                                <div id="chartLoading" class="chart-loading" style="display: none;">
                                    <div style="background: rgba(255, 255, 255, 0.95); padding: 1rem 1.5rem; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); backdrop-filter: blur(10px);">
                                        <i class="fas fa-spinner fa-spin me-2 text-primary"></i>
                                        <span style="color: #374151; font-weight: 500;">Đang tải dữ liệu...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Custom Legend -->
                        <div class="chart-legend">
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(135deg, #4f46e5, #6366f1);"></div>
                                <span>Sinh viên mới</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(135deg, #059669, #10b981);"></div>
                                <span>Nhà tuyển dụng</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(135deg, #dc2626, #ef4444);"></div>
                                <span>Tin tuyển dụng</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: linear-gradient(135deg, #d97706, #f59e0b);"></div>
                                <span>Sự kiện</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions (full width) -->
        <div class="row g-4 align-items-stretch">
            <div class="col-12 d-flex">
                <div class="card dashboard-card flex-fill h-100">
                    <div class="card-header bg-transparent border-0 pb-0">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-bolt text-warning me-2"></i>
                            Quick Actions
                        </h5>
                    </div>
                    <div class="card-body h-100">
                        <div class="row g-3 gx-0 h-100 d-flex flex-wrap align-items-stretch">
                            <div class="col-12 col-md-4 col-lg-2 d-flex">
                                <a href="/Admin/ListStudent" class="quick-action-btn flex-fill d-flex align-items-center justify-content-center">
                                    <div class="text-center w-100">
                                        <i class="fas fa-users fs-3 mb-2 text-primary"></i>
                                        <div class="fw-semibold">Manage Students</div>
                                        <small class="text-muted">View and manage student accounts</small>
                                    </div>
                                </a>
                            </div>
                            <div class="col-12 col-md-4 col-lg-2 d-flex">
                                <a href="/Admin/ListEmployer" class="quick-action-btn flex-fill d-flex align-items-center justify-content-center">
                                    <div class="text-center w-100">
                                        <i class="fas fa-building fs-3 mb-2 text-success"></i>
                                        <div class="fw-semibold">Manage Employers</div>
                                        <small class="text-muted">View and manage employer accounts</small>
                                    </div>
                                </a>
                            </div>
                            <div class="col-12 col-md-4 col-lg-2 d-flex">
                                <a href="/Admin/blogs" class="quick-action-btn flex-fill d-flex align-items-center justify-content-center">
                                    <div class="text-center w-100">
                                        <i class="fas fa-blog fs-3 mb-2 text-info"></i>
                                        <div class="fw-semibold">Manage Blogs</div>
                                        <small class="text-muted">Create and edit blog posts</small>
                                    </div>
                                </a>
                            </div>
                            <div class="col-12 col-md-4 col-lg-2 d-flex">
                                <a href="/Admin/List" class="quick-action-btn flex-fill d-flex align-items-center justify-content-center">
                                    <div class="text-center w-100">
                                        <i class="fas fa-flag fs-3 mb-2 text-danger"></i>
                                        <div class="fw-semibold">View Reports</div>
                                        <small class="text-muted">Handle user reports</small>
                                    </div>
                                </a>
                            </div>
                            <div class="col-12 col-md-4 col-lg-2 d-flex">
                                <a href="/Admin/AllJobPosts" class="quick-action-btn flex-fill d-flex align-items-center justify-content-center">
                                    <div class="text-center w-100">
                                        <i class="fas fa-briefcase fs-3 mb-2 text-warning"></i>
                                        <div class="fw-semibold">Job Posts</div>
                                        <small class="text-muted">Monitor all job postings</small>
                                    </div>
                                </a>
                            </div>
                            <div class="col-12 col-md-4 col-lg-2 d-flex">
                                <a href="/Admin/Events" class="quick-action-btn flex-fill d-flex align-items-center justify-content-center">
                                    <div class="text-center w-100">
                                        <i class="fas fa-calendar fs-3 mb-2 text-purple"></i>
                                        <div class="fw-semibold">Events</div>
                                        <small class="text-muted">Manage career events</small>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Status -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card dashboard-card">
                    <div class="card-header bg-transparent border-0">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-server text-success me-2"></i>
                            System Status
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-md-3">
                                <div class="d-flex align-items-center justify-content-center">
                                    <i class="fas fa-circle text-success me-2"></i>
                                    <span class="fw-semibold">Server Status</span>
                                </div>
                                <div class="text-success mt-1">Online</div>
                            </div>
                            <div class="col-md-3">
                                <div class="d-flex align-items-center justify-content-center">
                                    <i class="fas fa-circle text-success me-2"></i>
                                    <span class="fw-semibold">Database</span>
                                </div>
                                <div class="text-success mt-1">Connected</div>
                            </div>
                            <div class="col-md-3">
                                <div class="d-flex align-items-center justify-content-center">
                                    <i class="fas fa-circle text-success me-2"></i>
                                    <span class="fw-semibold">Email Service</span>
                                </div>
                                <div class="text-success mt-1">Active</div>
                            </div>
                            <div class="col-md-3">
                                <div class="d-flex align-items-center justify-content-center">
                                    <i class="fas fa-circle text-warning me-2"></i>
                                    <span class="fw-semibold">Backup Status</span>
                                </div>
                                <div class="text-warning mt-1">Scheduled</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/navbarAdmin.js}"></script>
<script th:src="@{/js/language-dropdown.js}"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Chart configuration and data
    const ctx = document.getElementById('statisticsChart').getContext('2d');
    
    // Initialize chart with loading state
    let statisticsChart;
    
    // Enhanced chart colors and configuration with gradients
    const chartColors = [
        { 
            border: '#4f46e5',
            shadowColor: 'rgba(79, 70, 229, 0.3)',
            label: 'Sinh viên mới',
            icon: '👨‍🎓'
        },
        { 
            border: '#059669',
            shadowColor: 'rgba(5, 150, 105, 0.3)', 
            label: 'Nhà tuyển dụng',
            icon: '🏢'
        },
        { 
            border: '#dc2626',
            shadowColor: 'rgba(220, 38, 38, 0.3)', 
            label: 'Tin tuyển dụng',
            icon: '💼'
        },
        { 
            border: '#d97706',
            shadowColor: 'rgba(217, 119, 6, 0.3)', 
            label: 'Sự kiện',
            icon: '📅'
        }
    ];
    
    // Function to load chart data from API
    function loadChartData(period) {
        // Update subtitle immediately
        updateChartSubtitle(period);
        
        // Show loading indicator
        showLoading(true);
        
        fetch(`/Admin/chart-data?period=${period}`)
            .then(response => response.json())
            .then(data => {
                showLoading(false);
                updateChart(data.labels, data.data);
            })
            .catch(error => {
                console.error('Error loading chart data:', error);
                showLoading(false);
                // Fallback to default data if API fails
                loadDefaultData(period);
            });
    }
    
    // Function to show/hide loading indicator
    function showLoading(show) {
        const loadingElement = document.getElementById('chartLoading');
        if (loadingElement) {
            loadingElement.style.display = show ? 'block' : 'none';
        }
    }
    
    // Function to create chart datasets from API data with enhanced styling
    function createDatasets(labels, data) {
        const ctx = document.getElementById('statisticsChart').getContext('2d');
        
        return data.map((dataSet, index) => {
            // Create gradient for each dataset
            const gradient = ctx.createLinearGradient(0, 0, 0, 400);
            const color = chartColors[index];
            
            gradient.addColorStop(0, color.border + '60'); // 38% opacity at top
            gradient.addColorStop(0.5, color.border + '30'); // 19% opacity at middle  
            gradient.addColorStop(1, color.border + '05'); // 2% opacity at bottom
            
            // Create border gradient
            const borderGradient = ctx.createLinearGradient(0, 0, 0, 400);
            borderGradient.addColorStop(0, color.border);
            borderGradient.addColorStop(1, color.border + 'CC'); // Slight fade
            
            return {
                label: color.label,
                data: dataSet,
                borderColor: borderGradient,
                backgroundColor: gradient,
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointBackgroundColor: color.border,
                pointBorderColor: '#ffffff',
                pointBorderWidth: 3,
                pointRadius: 6,
                pointHoverRadius: 10,
                pointHoverBackgroundColor: color.border,
                pointHoverBorderColor: '#ffffff',
                pointHoverBorderWidth: 4,
                // Add shadow effect
                shadowOffsetX: 2,
                shadowOffsetY: 2,
                shadowBlur: 6,
                shadowColor: color.shadowColor,
                // Animation settings
                borderCapStyle: 'round',
                borderJoinStyle: 'round'
            };
        });
    }
    
    // Function to update or create chart
    function updateChart(labels, data) {
        const chartData = {
            labels: labels,
            datasets: createDatasets(labels, data)
        };
        
        if (statisticsChart) {
            // Update existing chart
            statisticsChart.data = chartData;
            statisticsChart.update('active');
        } else {
            // Create new chart with enhanced configuration
            const config = {
                type: 'line',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    animation: {
                        duration: 1500,
                        easing: 'easeInOutCubic',
                        delay: (context) => {
                            let delay = 0;
                            if (context.type === 'data' && context.mode === 'default') {
                                delay = context.dataIndex * 50 + context.datasetIndex * 200;
                            }
                            return delay;
                        },
                    },
                    animations: {
                        tension: {
                            duration: 1000,
                            easing: 'linear',
                            from: 1,
                            to: 0.4,
                            loop: false
                        },
                        y: {
                            type: 'number',
                            easing: 'easeInOutCubic',
                            duration: 1200,
                            from: (ctx) => {
                                if (ctx.type === 'data') {
                                    const chart = ctx.chart;
                                    const {scales: {y}} = chart;
                                    return y.getPixelForValue(0);
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false // Using custom legend
                        },
                        tooltip: {
                            enabled: true,
                            backgroundColor: 'rgba(255, 255, 255, 0.98)',
                            titleColor: '#1e293b',
                            bodyColor: '#374151',
                            borderColor: '#e5e7eb',
                            borderWidth: 1,
                            cornerRadius: 12,
                            displayColors: false,
                            padding: 16,
                            titleFont: {
                                size: 14,
                                weight: '600'
                            },
                            bodyFont: {
                                size: 13,
                                weight: '500'
                            },
                            titleSpacing: 8,
                            bodySpacing: 6,
                            boxShadow: '0 10px 25px rgba(0, 0, 0, 0.15)',
                            callbacks: {
                                title: function(tooltipItems) {
                                    return `📊 ${tooltipItems[0].label}`;
                                },
                                label: function(context) {
                                    const color = chartColors[context.datasetIndex];
                                    return `${color.icon} ${context.dataset.label}: ${context.parsed.y.toLocaleString()} đăng ký`;
                                },
                                beforeBody: function() {
                                    return '━━━━━━━━━━━━━━━━━━━';
                                }
                            },
                            // Custom tooltip styling
                            titleAlign: 'center',
                            bodyAlign: 'left',
                            footerAlign: 'center'
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            grid: {
                                display: false,
                                drawBorder: false
                            },
                            ticks: {
                                font: {
                                    size: 12,
                                    weight: '500'
                                },
                                color: '#64748b',
                                maxRotation: 0,
                                padding: 10
                            },
                            border: {
                                display: false
                            }
                        },
                        y: {
                            display: true,
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(148, 163, 184, 0.1)',
                                borderDash: [3, 6],
                                drawBorder: false,
                                lineWidth: 1
                            },
                            ticks: {
                                font: {
                                    size: 12,
                                    weight: '500'
                                },
                                color: '#64748b',
                                padding: 15,
                                callback: function(value) {
                                    if (value >= 1000) {
                                        return (value / 1000).toFixed(1) + 'K';
                                    }
                                    return value.toLocaleString();
                                }
                            },
                            border: {
                                display: false
                            }
                        }
                    },
                    elements: {
                        point: {
                            hoverBackgroundColor: '#ffffff',
                            hoverBorderWidth: 4,
                            hoverRadius: 8
                        },
                        line: {
                            borderJoinStyle: 'round',
                            borderCapStyle: 'round'
                        }
                    },
                    layout: {
                        padding: {
                            top: 20,
                            right: 20,
                            bottom: 20,
                            left: 20
                        }
                    }
                }
            };
            
            statisticsChart = new Chart(ctx, config);
        }
        
        // Setup interactivity after chart update
        setupInteractionsAfterChart();
    }
    
    // Function to update chart subtitle based on period
    function updateChartSubtitle(period) {
        const subtitle = document.getElementById('chartSubtitle');
        const subtitles = {
            'day': 'Thống kê 30 ngày gần đây',
            'week': 'Thống kê 12 tuần gần đây', 
            'month': 'Thống kê 12 tháng gần đây',
            'year': 'Thống kê theo năm'
        };
        
        if (subtitle && subtitles[period]) {
            subtitle.textContent = subtitles[period];
        }
    }
    
    // Fallback function with default data
    function loadDefaultData(period) {
        let labels, data;
        
        updateChartSubtitle(period);
        
        if (period === 'day') {
            // Last 30 days
            labels = [];
            const today = new Date();
            for (let i = 29; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                labels.push(date.getDate() + '/' + (date.getMonth() + 1));
            }
            data = [
                Array.from({length: 30}, () => Math.floor(Math.random() * 15) + 5),
                Array.from({length: 30}, () => Math.floor(Math.random() * 8) + 2),
                Array.from({length: 30}, () => Math.floor(Math.random() * 12) + 3),
                Array.from({length: 30}, () => Math.floor(Math.random() * 5) + 1)
            ];
        } else if (period === 'week') {
            // Last 12 weeks
            labels = [];
            const today = new Date();
            for (let i = 11; i >= 0; i--) {
                const weekStart = new Date(today);
                weekStart.setDate(weekStart.getDate() - (i * 7));
                labels.push('Tuần ' + (52 - i));
            }
            data = [
                Array.from({length: 12}, () => Math.floor(Math.random() * 50) + 20),
                Array.from({length: 12}, () => Math.floor(Math.random() * 20) + 8),
                Array.from({length: 12}, () => Math.floor(Math.random() * 35) + 15),
                Array.from({length: 12}, () => Math.floor(Math.random() * 15) + 5)
            ];
        } else if (period === 'year') {
            // Last 5 years
            const currentYear = new Date().getFullYear();
            labels = [];
            for (let i = 4; i >= 0; i--) {
                labels.push((currentYear - i).toString());
            }
            data = [
                [150, 280, 420, 650, 850],
                [45, 85, 125, 180, 220],
                [80, 150, 240, 350, 450],
                [25, 45, 70, 100, 130]
            ];
        } else {
            // Default: month
            labels = ['T1', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7', 'T8', 'T9', 'T10', 'T11', 'T12'];
            data = [
                [20, 25, 18, 30, 28, 35, 38, 32, 29, 36, 33, 40],
                [5, 8, 6, 10, 9, 12, 14, 11, 10, 13, 15, 17],
                [12, 15, 13, 18, 16, 20, 22, 19, 17, 23, 25, 28],
                [2, 3, 2, 4, 3, 5, 6, 5, 4, 6, 7, 8]
            ];
        }
        
        updateChart(labels, data);
    }
    
    // Load initial chart data
    loadChartData('month');

    // Handle period filter buttons
    const periodButtons = document.querySelectorAll('input[name="chartPeriod"]');
    periodButtons.forEach(button => {
        button.addEventListener('change', function() {
            const period = this.value;
            loadChartData(period);
        });
    });
    
    // Add interactive legend functionality
    function setupLegendInteractivity() {
        const legendItems = document.querySelectorAll('.legend-item');
        legendItems.forEach((item, index) => {
            item.addEventListener('click', function() {
                if (statisticsChart) {
                    const meta = statisticsChart.getDatasetMeta(index);
                    meta.hidden = meta.hidden === null ? !meta.data[0].active : !meta.hidden;
                    
                    // Update legend item visual state
                    if (meta.hidden) {
                        item.style.opacity = '0.5';
                        item.style.filter = 'grayscale(100%)';
                    } else {
                        item.style.opacity = '1';
                        item.style.filter = 'grayscale(0%)';
                    }
                    
                    statisticsChart.update();
                }
            });
            
            // Add tooltip for legend items
            item.title = `Click to toggle ${chartColors[index].label}`;
        });
    }
    
    // Call setup after chart is ready
    function setupInteractionsAfterChart() {
        setTimeout(() => {
            setupLegendInteractivity();
        }, 200);
    }
});
</script>

</body>
</html>