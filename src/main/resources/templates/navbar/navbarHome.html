<!DOCTYPE html>
<html
  lang="vi"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.w3.org/1999/xhtml"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Navbar</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <!-- Link to global styles (navbarHome.css) -->
    <link rel="stylesheet" th:href="@{/css/navbarHome.css}" />
    <!-- Link to specific navbar styles -->
    <link rel="stylesheet" th:href="@{/css/navbar.css}" />
    <link rel="stylesheet" th:href="@{/css/navbarEnhanced.css}" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css"
    />
  </head>
  <body>
    <!-- Navbar Fragment -->
    <div class="navbar-container" th:fragment="home">
      <div class="navbar">
        <div class="navbar-left">
          <div class="logo">
            <a th:href="@{/}" class="text-logo-link">
              <div class="text-logo">JOB4YOU</div>
            </a>
          </div>
          <a href="#" class="nav-link" th:text="#{nav.jobs}">Vi·ªác l√†m</a>
          <a href="#" class="nav-link" th:text="#{nav.createCV}">T·∫°o CV</a>
          <a href="#" class="nav-link" th:text="#{nav.tools}">C√¥ng c·ª•</a>
          <a th:href="@{/Blog}" class="nav-link" th:text="#{nav.blogs}">Blogs</a>
          <a href="#" class="nav-link" th:text="#{nav.events}">Events</a>
        </div>

        <div class="navbar-right">
          <!-- Language Switcher - Always visible -->
          <div class="language-switcher-container">
            <button class="language-switcher" th:text="#{app.language}">LANGUAGE</button>
            <div class="language-dropdown">
              <a href="?lang=en" class="language-option" th:classappend="${#locale.language == 'en'} ? 'active'">
                <span class="flag">üá∫üá∏</span> English
              </a>
              <a href="?lang=vi" class="language-option" th:classappend="${#locale.language == 'vi'} ? 'active'">
                <span class="flag">üáªüá≥</span> Ti·∫øng Vi·ªát
              </a>
            </div>
          </div>

          <!-- Authenticated User Section -->
          <div sec:authorize="isAuthenticated()" class="authenticated-section">
            <div th:if="${userEmail}" class="dropdown">
              <input
                type="checkbox"
                id="dropdown-toggle"
                class="dropdown-toggle"
              />
              <label for="dropdown-toggle" class="nav-link user-greeting">
                <span th:text="#{app.account}"></span>
                <i class="bi bi-person-circle"></i>
                <i class="bi bi-caret-down-fill"></i>
              </label>
              <div class="dropdown-menu">
                <a
                  class="dropdown-item"
                  th:href="@{/Student}"
                  sec:authorize="hasRole('student')"
                  th:text="#{nav.account}">T√†i kho·∫£n</a
                >
                <a
                  class="dropdown-item"
                  th:href="@{/Employer}"
                  sec:authorize="hasRole('employer')"
                  th:text="#{nav.account}">T√†i kho·∫£n</a
                >
                <a
                  class="dropdown-item"
                  th:href="@{/Admin}"
                  sec:authorize="hasRole('admin')"
                  th:text="#{nav.account}">T√†i kho·∫£n</a
                >
              </div>
            </div>
            <a th:href="@{/logout}" class="nav-action-btn nav-logout-btn"
              ><i class="bi bi-box-arrow-in-right"></i> <span th:text="#{nav.logout}">Logout</span></a
            >
          </div>

          <!-- Anonymous User Section -->
          <div sec:authorize="isAnonymous()" class="anonymous-section">
            <a th:href="@{/Register}" class="nav-action-btn nav-register-btn"
              ><i class="bi bi-person-plus-fill"></i> <span th:text="#{nav.register}">ƒêƒÉng k√Ω</span></a
            >
            <a th:href="@{/Login}" class="nav-action-btn nav-login-btn"
              ><i class="bi bi-box-arrow-in-right"></i> <span th:text="#{nav.login}">ƒêƒÉng nh·∫≠p</span></a
            >
          </div>
        </div>
      </div>
    </div>
  </body>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Language switcher functionality
    const languageOptions = document.querySelectorAll('.language-option');
    languageOptions.forEach(option => {
      option.addEventListener('click', function(event) {
        event.preventDefault();
        const lang = this.getAttribute('href').split('=')[1];
        const currentUrl = new URL(window.location.href);
        currentUrl.searchParams.set('lang', lang);
        window.location.href = currentUrl.toString();
      });
    });

    const languageButton = document.querySelector('.language-switcher');
    const languageDropdown = document.querySelector('.language-dropdown');
    if (languageButton && languageDropdown) {
      languageButton.addEventListener('click', function(event) {
        event.stopPropagation();
        languageDropdown.classList.toggle('active');
      });
      document.addEventListener('click', function(event) {
        if (!languageButton.contains(event.target) && !languageDropdown.contains(event.target)) {
          languageDropdown.classList.remove('active');
        }
      });
    }

    // Booking modal functionality
    const openBtnNavbar = document.getElementById('openBookingModalNavbar');
    const modal = document.getElementById('bookingModal');
    const modalContent = document.querySelector('.booking-modal-content-popover');
    const closeBtn = document.getElementById('closeBookingModal');

    function hideModal() {
      modal.style.display = 'none';
    }

    if (openBtnNavbar && modal && closeBtn && modalContent) {
      openBtnNavbar.addEventListener('click', function() {
        const rect = openBtnNavbar.getBoundingClientRect();
        const modalWidth = modalContent.offsetWidth;
        const windowWidth = window.innerWidth;

        // Position vertically below the button
        modalContent.style.top = (rect.bottom + window.scrollY + 5) + 'px';

        // Center the modal horizontally relative to the button
        let leftPosition = rect.left + window.scrollX + (rect.width / 2) - (modalWidth / 2);

        // Ensure the modal doesn't go off-screen
        if (leftPosition < 10) {
          leftPosition = 10; // Keep a small margin from the left edge
        } else if (leftPosition + modalWidth > windowWidth - 10) {
          leftPosition = windowWidth - modalWidth - 10; // Keep a small margin from the right edge
        }

        modalContent.style.left = leftPosition + 'px';
        modal.style.display = 'block';
      });

      closeBtn.addEventListener('click', hideModal);

      window.addEventListener('click', function(event) {
        if (event.target === modal) {
          hideModal();
        }
      });

      // Adjust position on window resize
      window.addEventListener('resize', function() {
        if (modal.style.display === 'block') {
          const rect = openBtnNavbar.getBoundingClientRect();
          const modalWidth = modalContent.offsetWidth;
          const windowWidth = window.innerWidth;

          modalContent.style.top = (rect.bottom + window.scrollY + 5) + 'px';
          let leftPosition = rect.left + window.scrollX + (rect.width / 2) - (modalWidth / 2);

          if (leftPosition < 10) {
            leftPosition = 10;
          } else if (leftPosition + modalWidth > windowWidth - 10) {
            leftPosition = windowWidth - modalWidth - 10;
          }

          modalContent.style.left = leftPosition + 'px';
        }
      });
    }
  });
</script>
</html>
