<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Blog Management</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap & Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/managementBlog.css}">
    <link rel="stylesheet" th:href="@{/css/navbarAdmin.css}">
    <link rel="stylesheet" th:href="@{/css/adminCommon.css}">
</head>
<body class="management-blog-bg">
<div th:replace="~{navbar/navbarAdmin :: navbarAdmin}"></div>
<div class="container mt-4 d-flex flex-column align-items-center">
    <h2 class="mb-4 management-blog-title text-center">
        <i class="bi bi-journal-text"></i> Blog Management
    </h2>
    <div class="table-responsive management-blog-table">
        <table class="table table-hover align-middle shadow-sm mb-0">
            <thead>
            <tr>
                <th><i class="bi bi-file-earmark-text"></i> Title</th>
                <th><i class="bi bi-link-45deg"></i> Resource Type</th>
                <th><i class="bi bi-info-circle"></i> Status</th>
                <th><i class="bi bi-calendar"></i> Created At</th>
                <th><i class="bi bi-eye"></i> Actions</th>
            </tr>
            </thead>
            <tbody id="blog-table-body">
            <tr th:each="blog : ${blogs}">
                <td>
                    <div class="blog-title">
                        <i class="bi bi-file-earmark-text"></i>
                        <span th:text="${blog.title}"></span>
                    </div>
                    <div class="blog-summary">
                        <i class="bi bi-card-text"></i>
                        <span th:text="${blog.summary}"></span>
                    </div>
                </td>
                <td>
                    <span th:if="${blog.resource != null}" class="resource-badge">
                        <i class="bi bi-link-45deg"></i>
                        <span th:text="${blog.resource.resourceType}"></span>
                    </span>
                    <span th:if="${blog.resource == null}" class="text-muted">
                        <i class="bi bi-x-circle"></i> No resource
                    </span>
                </td>
                <td>
                    <form th:action="@{/Admin/blogs/{id}/status(id=${blog.blogPostId})}" method="post" style="display:inline;">
                        <div class="d-flex align-items-center justify-content-center gap-2">
                            <i class="bi bi-info-circle"></i>
                            <select name="status" class="form-select form-select-sm status-select"
                                    onchange="confirmStatusChange(this)" th:data-old-value="${blog.status}">
                                <option th:each="status : ${T(com.example.swp391_d01_g3.model.BlogPost.BlogStatus).values()}"
                                        th:value="${status}" th:text="${status}" th:selected="${blog.status != null and status.name() == blog.status.name()}"
                                ></option>
                            </select>
                        </div>
                    </form>
                </td>
                <td>
                    <i class="bi bi-calendar"></i>
                    <span th:text="${#temporals.format(blog.createdAt, 'dd/MM/yyyy HH:mm')}"></span>
                </td>
                <td>
                    <a th:href="@{/Admin/blogs/{id}(id=${blog.blogPostId})}" class="btn btn-sm management-blog-btn-view">
                        <i class="bi bi-eye"></i> View
                    </a>
                    <a th:href="@{/Admin/blogs/{id}/edit(id=${blog.blogPostId})}" class="btn btn-sm btn-warning ms-1">
                        <i class="bi bi-pencil-square"></i> Edit
                    </a>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
    <div id="pagination" class="d-flex justify-content-center mt-3"></div>
</div>
<script>
    const rowsPerPage = 10;
    const tableBody = document.getElementById('blog-table-body');
    const allRows = Array.from(tableBody.querySelectorAll('tr'));
    const totalPages = Math.ceil(allRows.length / rowsPerPage);
    const paginationDiv = document.getElementById('pagination');

    function showPage(page) {
        if(page < 0 || page >= totalPages) return;
        allRows.forEach((row, idx) => {
            row.style.display = (idx >= page * rowsPerPage && idx < (page + 1) * rowsPerPage) ? '' : 'none';
        });
        renderPagination(page);
    }
    function renderPagination(currentPage) {
        let html = `<nav aria-label="Page navigation"><ul class="pagination">`;
        html += `<li class="page-item${currentPage === 0 ? ' disabled' : ''}"><a class="page-link" href="#" onclick="showPage(${currentPage-1});return false;">&laquo;</a></li>`;
        for(let i=0; i<totalPages; i++) {
            html += `<li class="page-item${i===currentPage?' active':''}"><a class="page-link" href="#" onclick="showPage(${i});return false;">${i+1}</a></li>`;
        }
        html += `<li class="page-item${currentPage === totalPages-1 ? ' disabled' : ''}"><a class="page-link" href="#" onclick="showPage(${currentPage+1});return false;">&raquo;</a></li>`;
        html += `</ul></nav>`;
        paginationDiv.innerHTML = html;
    }
    if (allRows.length > 0) showPage(0);

    function confirmStatusChange(selectElem) {
        const oldValue = selectElem.getAttribute('data-old-value');
        const newValue = selectElem.value;
        if (oldValue === newValue) return;
        if (confirm("Bạn có chắc chắn muốn thay đổi trạng thái?")) {
            selectElem.form.submit();
        } else {
            selectElem.value = oldValue;
        }
    }
</script>
<script th:src="@{/js/navbarAdmin.js}"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
